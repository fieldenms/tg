package ua.com.fielden.platform.attachment;

import com.google.inject.ImplementedBy;

import java.nio.file.Path;

/**
 * A contract to provide malware scanning of file attachments.
 * <p>
 * Malware scanning is application-specific.
 * Appropriate implementation should be provided at the level of applications, which would take into account the deployment environment.
 */
@ImplementedBy(NoOpMalwareScanner.class)
public interface IMalwareScanner {

    /**
     * Successful result should indicate that no malware was found.
     * Unsuccessful results might indicate one of tree possible situations:
     * <ul>
     *     <li>Malware was identified.</li>
     *     <li>Malware scanner was not available.</li>
     *     <li>Some error occurred during scanning.</li>
     * </ul>
     * In all these situations, the attachment uploader should refuse to save a file and create a corresponding attachment record.
     *
     * @param pathToFile  A path to the file for scanning.
     * @return A result of scanning.
     */
    ScanResult scan(final Path pathToFile);

    /**
     * A contract for expressing scanning results.
     */
    sealed interface ScanResult  {
        String info();

        // There are 4 possible scan results.
        record Found(String info) implements ScanResult {}
        record Ok(String info) implements ScanResult {}
        record ScannerNotAvailable(String info) implements  ScanResult {}
        record ScannerError(String info) implements  ScanResult {}
    }

}
