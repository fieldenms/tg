<link rel="import" href="/resources/polymer/polymer/polymer.html">
<link rel="import" href="/resources/polymer/iron-dropdown/iron-dropdown.html">
<link rel="import" href="/resources/polymer/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/resources/actions/tg-ui-action.html">
<link rel="import" href="/resources/actions/tg-page-action.html">

<dom-module id="tg-secondary-action-button">
    <style>
        .dropdown-content {
            background-color: white;
            box-shadow: 0px 2px 6px #ccc;
            padding: 5px;
        }
    </style>
    <template>
        <paper-icon-button icon="more-vert" on-tap="_showDropDown"></paper-icon-button>
        <iron-dropdown id="dropdown" style="color:black" on-tap="_closeDropDown">
            <div class="dropdown-content layout vertical">
                <template is="dom-repeat" items="[[actions]]" as="action">
                    <tg-page-action icon="[[action.icon]]" action="[[action.action]]" current-entity="[[currentEntity]]" hidden$="[[!action.action]]" element-name="[[action.elementName]]" attrs="[[action.attrs]]" component-uri="[[action.componentUri]]" view-type="[[action.viewType]]"></tg-page-action>
                    <tg-ui-action show-dialog="[[action.showDialog]]" current-entity="[[currentEntity]]" hidden$="[[action.action]]" short-desc="[[action.shortDesc]]" should-refresh-parent-centre-after-save="[[action.shouldRefreshParentCentreAfterSave]]" long-desc="[[action.longDesc]]" icon="[[action.icon]]" component-uri="[[action.componentUri]]" element-name="[[action.elementName]]" element-alias="[[action.elementAlias]]" attrs="[[action.attrs]]" create-context-holder="[[action.createContextHolder]]" require-selection-criteria="[[action.requireSelectionCriteria]]" require-selected-entities="[[action.requireSelectedEntities]]" require-master-entity="[[action.requireMasterEntity]]" pre-action="[[action.preAction]]" post-action-success="[[action.postActionSuccess]]" post-action-error="[[action.postActionError]]"></tg-ui-action>
                </template>
            </div>
        </iron-dropdown>
    </template>
</dom-module>
<script>
    (function () {
        Polymer({

            is: "tg-secondary-action-button",

            properties: {
                actions: Array,
                /**
                 * The 'currentEntity' should contain the entity that was clicked (result-set actions)
                 * or the entity on which primary / secondary action was chosen. In case when no of the above cases
                 * is invoking (for e.g. as in topLevel actions) -- 'currentEntity' should be empty.
                 */
                currentEntity: Object
            },

            _showDropDown: function (e, detail) {
                this.$.dropdown.toggle();
            },

            _closeDropDown: function (e, detail) {
                this.$.dropdown.toggle();
            }
        });
    })();
</script>